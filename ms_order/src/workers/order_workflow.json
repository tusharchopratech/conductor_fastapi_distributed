{
  "name": "scheduled_order_submission_workflow",
  "description": "Periodically fetches new orders from Service 1 and initiates fulfillment workflows.",
  "version": 1,
  "inputParameters": [
    "order_id"
  ],
  "tasks": [
    {
      "name": "fetch_new_orders_from_db",
      "taskReferenceName": "fetch_new_orders_from_db_ref",
      "inputParameters": {
        "batchSize": 100,
        "statusToFetch": "${workflow.input.order_id}"
      },
      "type": "SIMPLE",
      "description": "Service 1 worker fetches a batch of orders with status 'NEW'."
    },
    {
      "name": "http_poll",
      "taskReferenceName": "http_poll_ref",
      "type": "HTTP_POLL",
      "inputParameters": {
        "http_request": {
          "uri": "https://05b8-205-210-143-170.ngrok-free.app/poll-mib",
          "method": "GET",
          "accept": "application/json",
          "contentType": "application/json",
          "terminationCondition": "$.output.response.body.search_status == 'DONE' ? true : false;",
          "pollingInterval": "10",
          "pollingStrategy": "FIXED",
          "encode": true,
          "headers": {
            "ngrok-skip-browser-warning": true
          },
          "body": {
            "key": "value"
          }
        }
      }
    },
    {
      "name": "poll_search_id",
      "taskReferenceName": "poll_search_id_ref",
      "inputParameters": {
        "search_id": "some_search_id"
      },
      "type": "SIMPLE",
      "description": "Polling search_id task",
      "retryCount": 3,
      "retryLogic": "FIXED",
      "retryDelaySeconds": 10,
      "timeoutSeconds": 60,
      "timeoutPolicy": "TIME_OUT_WF",
      "responseTimeoutSeconds": 30
    }    
  ],
  "outputParameters": {
    "numOrdersFetched": "${fetch_new_orders_from_db_ref.output.numOrders}"
  }
}